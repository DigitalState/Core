services:
  ds_tenant.event_listener.context:
    class: '%ds_tenant.event_listener.context.class%'
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@ds_tenant.service.tenant'
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onPreAuthentication, priority: 255 }
      - { name: kernel.event_listener, event: kernel.request, method: onPostAuthentication, priority: 5 }

  ds_tenant.event_listener.loader:
    class: '%ds_tenant.event_listener.loader.class%'
    arguments:
      - '@service_container'
    tags:
      - { name: doctrine.orm.entity_listener, entity: '%ds_tenant.entity.tenant.class%', event: prePersist, priority: 2 }
      - { name: doctrine.orm.entity_listener, entity: '%ds_tenant.entity.tenant.class%', event: postRemove, priority: 2 }

  ds_tenant.event_listener.entity.tenantable:
    class: '%ds_tenant.event_listener.entity.tenantable.class%'
    arguments:
      - '@service_container'
    tags:
      - { name: doctrine.event_listener, event: prePersist }

  ds_tenant.event_listener.token.tenant:
    class: '%ds_tenant.event_listener.token.tenant.class%'
    tags:
      - { name: kernel.event_listener, event: lexik_jwt_authentication.on_jwt_created, method: created }
      - { name: kernel.event_listener, event: lexik_jwt_authentication.on_jwt_decoded, method: decoded }
